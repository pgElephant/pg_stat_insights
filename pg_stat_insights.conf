# -----------------------------------------------------------------------
# pg_stat_insights configuration file
# -----------------------------------------------------------------------
#
# This file contains configuration parameters for the pg_stat_insights
# PostgreSQL extension. Place this file in your PostgreSQL data directory
# or include it in postgresql.conf using:
#   include = 'pg_stat_insights.conf'
#
# -----------------------------------------------------------------------

# ============================================================================
# Core Settings
# ============================================================================

# Maximum number of distinct queries to track
# Higher values provide more coverage but use more shared memory
# Default: 5000, Range: 100 to INT_MAX/2
pg_stat_insights.max = 5000

# Which statements to track: 'none', 'top', or 'all'
# - none: Don't track any statements
# - top:  Track only top-level statements (default, recommended)
# - all:  Track all statements including nested (high overhead)
pg_stat_insights.track = top

# Track utility commands (CREATE, DROP, ALTER, etc.)
# Default: on
pg_stat_insights.track_utility = on

# Track planning duration separately from execution
# Provides insights into planner performance
# Default: off (set to 'on' for detailed analysis)
pg_stat_insights.track_planning = on

# Save statistics across server shutdowns
# Default: on (recommended for production)
pg_stat_insights.save = on

# ============================================================================
# pg_stat_insights Enhanced Features
# ============================================================================

# Track response time histogram distribution
# Provides 10 buckets: <1ms, 1-10ms, 10-100ms, 100ms-1s, 1-10s, 10-60s,
# 1-5min, 5-10min, 10-30min, >30min
# Default: on
# Performance impact: minimal (simple counter increment)
pg_stat_insights.track_histograms = on

# Capture actual query parameter values
# WARNING: May expose sensitive data (passwords, PII, etc.)
# Only enable in development/testing environments
# Default: off (for security)
# Storage impact: +1KB per query
pg_stat_insights.capture_parameters = off

# Capture full EXPLAIN plan text
# Stores the complete query execution plan
# Useful for detailed performance analysis
# Default: off (high storage cost)
# Storage impact: +8KB per query
pg_stat_insights.capture_plan_text = off

# Extract and store SQL comments
# Useful for categorizing queries by comment tags
# Example: /* app:checkout */ SELECT ...
# Default: on
# Storage impact: +512 bytes per query
pg_stat_insights.capture_comments = on

# Time interval for bucket tracking (seconds)
# Set to 0 to disable bucket-based tracking
# Buckets provide time-series query performance data
# Default: 60 seconds
# Range: 0 (disabled) to 3600 (1 hour)
# Recommendation: 60 for 1-minute buckets, 300 for 5-minute buckets
pg_stat_insights.bucket_time = 60

# Maximum number of time buckets to retain
# Older buckets are rotated out
# Default: 10
# Range: 1 to 100
# Note: With bucket_time=60 and max_buckets=10, you get 10 minutes of history
pg_stat_insights.max_buckets = 10

# ============================================================================
# Recommended Production Settings
# ============================================================================
#
# For production monitoring (balanced):
#   pg_stat_insights.max = 10000
#   pg_stat_insights.track = top
#   pg_stat_insights.track_planning = on
#   pg_stat_insights.track_histograms = on
#   pg_stat_insights.capture_parameters = off
#   pg_stat_insights.capture_plan_text = off
#   pg_stat_insights.bucket_time = 300  # 5-minute buckets
#   pg_stat_insights.max_buckets = 12   # 1 hour of history
#
# For development/debugging (detailed):
#   pg_stat_insights.max = 5000
#   pg_stat_insights.track = all
#   pg_stat_insights.track_planning = on
#   pg_stat_insights.track_histograms = on
#   pg_stat_insights.capture_parameters = on
#   pg_stat_insights.capture_plan_text = on
#   pg_stat_insights.bucket_time = 60
#   pg_stat_insights.max_buckets = 30
#
# For minimal overhead:
#   pg_stat_insights.max = 1000
#   pg_stat_insights.track = top
#   pg_stat_insights.track_planning = off
#   pg_stat_insights.track_histograms = off
#   pg_stat_insights.capture_parameters = off
#   pg_stat_insights.capture_plan_text = off
#   pg_stat_insights.bucket_time = 0
#
# ============================================================================
# Storage Impact Summary
# ============================================================================
#
# Base pg_stat_statements: ~500 bytes per query
# + histograms:            +80 bytes per query
# + bucket tracking:       +24 bytes per query
# + comments:              +512 bytes per query
# + parameters:            +1024 bytes per query
# + plan text:             +8192 bytes per query
#
# Total with all features: ~10,332 bytes per query
# With max=5000: ~50MB shared memory
#
# ============================================================================
