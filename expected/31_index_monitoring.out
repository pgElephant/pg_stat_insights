-- ============================================================================
-- Test 31: Index Monitoring Views
-- Tests all index monitoring views and their functionality
-- ============================================================================
-- Setup test tables and indexes
-- Use fixed timestamp for deterministic test output
CREATE TABLE IF NOT EXISTS idx_test_users (
    id SERIAL PRIMARY KEY,
    username TEXT NOT NULL,
    email TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT '2025-11-22 14:52:32.72989'::timestamp,
    last_login TIMESTAMP,
    status TEXT DEFAULT 'active'
);
CREATE TABLE IF NOT EXISTS idx_test_orders (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL,
    amount DECIMAL(10,2),
    order_date DATE DEFAULT '2025-11-22'::date,
    status TEXT DEFAULT 'pending'
);
-- Create various index types
CREATE INDEX IF NOT EXISTS idx_users_username ON idx_test_users(username);
CREATE INDEX IF NOT EXISTS idx_users_email ON idx_test_users(email);
CREATE INDEX IF NOT EXISTS idx_users_created ON idx_test_users(created_at);
CREATE INDEX IF NOT EXISTS idx_orders_user_id ON idx_test_orders(user_id);
CREATE INDEX IF NOT EXISTS idx_orders_date ON idx_test_orders(order_date);
CREATE INDEX IF NOT EXISTS idx_orders_status ON idx_test_orders(status);
-- Insert test data with deterministic timestamps
INSERT INTO idx_test_users (username, email, created_at) 
SELECT 'user' || i, 'user' || i || '@test.com', '2025-11-22 14:52:32.72989'::timestamp - (i || ' days')::interval
FROM generate_series(1, 500) i;
INSERT INTO idx_test_orders (user_id, amount, order_date, status)
SELECT (i % 100) + 1, ((i * 17) % 1000)::decimal(10,2), '2025-11-22'::date - (i % 30), 
       CASE WHEN i % 3 = 0 THEN 'completed' WHEN i % 3 = 1 THEN 'pending' ELSE 'cancelled' END
FROM generate_series(1, 1000) i;
-- Execute queries to generate index usage statistics
SELECT * FROM idx_test_users WHERE username = 'user100';
 id  | username |      email       |           created_at           | last_login | status 
-----+----------+------------------+--------------------------------+------------+--------
 100 | user100  | user100@test.com | Thu Aug 14 14:52:32.72989 2025 |            | active
(1 row)

SELECT * FROM idx_test_users WHERE email = 'user200@test.com';
 id  | username |      email       |           created_at           | last_login | status 
-----+----------+------------------+--------------------------------+------------+--------
 200 | user200  | user200@test.com | Tue May 06 14:52:32.72989 2025 |            | active
(1 row)

SELECT * FROM idx_test_users WHERE created_at > '2025-11-22 14:52:32.72989'::timestamp - interval '30 days';
 id | username |      email      |           created_at           | last_login | status 
----+----------+-----------------+--------------------------------+------------+--------
  1 | user1    | user1@test.com  | Fri Nov 21 14:52:32.72989 2025 |            | active
  2 | user2    | user2@test.com  | Thu Nov 20 14:52:32.72989 2025 |            | active
  3 | user3    | user3@test.com  | Wed Nov 19 14:52:32.72989 2025 |            | active
  4 | user4    | user4@test.com  | Tue Nov 18 14:52:32.72989 2025 |            | active
  5 | user5    | user5@test.com  | Mon Nov 17 14:52:32.72989 2025 |            | active
  6 | user6    | user6@test.com  | Sun Nov 16 14:52:32.72989 2025 |            | active
  7 | user7    | user7@test.com  | Sat Nov 15 14:52:32.72989 2025 |            | active
  8 | user8    | user8@test.com  | Fri Nov 14 14:52:32.72989 2025 |            | active
  9 | user9    | user9@test.com  | Thu Nov 13 14:52:32.72989 2025 |            | active
 10 | user10   | user10@test.com | Wed Nov 12 14:52:32.72989 2025 |            | active
 11 | user11   | user11@test.com | Tue Nov 11 14:52:32.72989 2025 |            | active
 12 | user12   | user12@test.com | Mon Nov 10 14:52:32.72989 2025 |            | active
 13 | user13   | user13@test.com | Sun Nov 09 14:52:32.72989 2025 |            | active
 14 | user14   | user14@test.com | Sat Nov 08 14:52:32.72989 2025 |            | active
 15 | user15   | user15@test.com | Fri Nov 07 14:52:32.72989 2025 |            | active
 16 | user16   | user16@test.com | Thu Nov 06 14:52:32.72989 2025 |            | active
 17 | user17   | user17@test.com | Wed Nov 05 14:52:32.72989 2025 |            | active
 18 | user18   | user18@test.com | Tue Nov 04 14:52:32.72989 2025 |            | active
 19 | user19   | user19@test.com | Mon Nov 03 14:52:32.72989 2025 |            | active
 20 | user20   | user20@test.com | Sun Nov 02 14:52:32.72989 2025 |            | active
 21 | user21   | user21@test.com | Sat Nov 01 14:52:32.72989 2025 |            | active
 22 | user22   | user22@test.com | Fri Oct 31 14:52:32.72989 2025 |            | active
 23 | user23   | user23@test.com | Thu Oct 30 14:52:32.72989 2025 |            | active
 24 | user24   | user24@test.com | Wed Oct 29 14:52:32.72989 2025 |            | active
 25 | user25   | user25@test.com | Tue Oct 28 14:52:32.72989 2025 |            | active
 26 | user26   | user26@test.com | Mon Oct 27 14:52:32.72989 2025 |            | active
 27 | user27   | user27@test.com | Sun Oct 26 14:52:32.72989 2025 |            | active
 28 | user28   | user28@test.com | Sat Oct 25 14:52:32.72989 2025 |            | active
 29 | user29   | user29@test.com | Fri Oct 24 14:52:32.72989 2025 |            | active
(29 rows)

SELECT * FROM idx_test_orders WHERE user_id = 50;
 id  | user_id | amount | order_date |  status   
-----+---------+--------+------------+-----------
  49 |      50 | 833.00 | 11-03-2025 | pending
 149 |      50 | 533.00 | 10-24-2025 | cancelled
 249 |      50 | 233.00 | 11-13-2025 | completed
 349 |      50 | 933.00 | 11-03-2025 | pending
 449 |      50 | 633.00 | 10-24-2025 | cancelled
 549 |      50 | 333.00 | 11-13-2025 | completed
 649 |      50 |  33.00 | 11-03-2025 | pending
 749 |      50 | 733.00 | 10-24-2025 | cancelled
 849 |      50 | 433.00 | 11-13-2025 | completed
 949 |      50 | 133.00 | 11-03-2025 | pending
(10 rows)

SELECT * FROM idx_test_orders WHERE order_date > '2025-11-22'::date - 7 ORDER BY id;
 id  | user_id | amount | order_date |  status   
-----+---------+--------+------------+-----------
   1 |       2 |  17.00 | 11-21-2025 | pending
   2 |       3 |  34.00 | 11-20-2025 | cancelled
   3 |       4 |  51.00 | 11-19-2025 | completed
   4 |       5 |  68.00 | 11-18-2025 | pending
   5 |       6 |  85.00 | 11-17-2025 | cancelled
   6 |       7 | 102.00 | 11-16-2025 | completed
  30 |      31 | 510.00 | 11-22-2025 | completed
  31 |      32 | 527.00 | 11-21-2025 | pending
  32 |      33 | 544.00 | 11-20-2025 | cancelled
  33 |      34 | 561.00 | 11-19-2025 | completed
  34 |      35 | 578.00 | 11-18-2025 | pending
  35 |      36 | 595.00 | 11-17-2025 | cancelled
  36 |      37 | 612.00 | 11-16-2025 | completed
  60 |      61 |  20.00 | 11-22-2025 | completed
  61 |      62 |  37.00 | 11-21-2025 | pending
  62 |      63 |  54.00 | 11-20-2025 | cancelled
  63 |      64 |  71.00 | 11-19-2025 | completed
  64 |      65 |  88.00 | 11-18-2025 | pending
  65 |      66 | 105.00 | 11-17-2025 | cancelled
  66 |      67 | 122.00 | 11-16-2025 | completed
  90 |      91 | 530.00 | 11-22-2025 | completed
  91 |      92 | 547.00 | 11-21-2025 | pending
  92 |      93 | 564.00 | 11-20-2025 | cancelled
  93 |      94 | 581.00 | 11-19-2025 | completed
  94 |      95 | 598.00 | 11-18-2025 | pending
  95 |      96 | 615.00 | 11-17-2025 | cancelled
  96 |      97 | 632.00 | 11-16-2025 | completed
 120 |      21 |  40.00 | 11-22-2025 | completed
 121 |      22 |  57.00 | 11-21-2025 | pending
 122 |      23 |  74.00 | 11-20-2025 | cancelled
 123 |      24 |  91.00 | 11-19-2025 | completed
 124 |      25 | 108.00 | 11-18-2025 | pending
 125 |      26 | 125.00 | 11-17-2025 | cancelled
 126 |      27 | 142.00 | 11-16-2025 | completed
 150 |      51 | 550.00 | 11-22-2025 | completed
 151 |      52 | 567.00 | 11-21-2025 | pending
 152 |      53 | 584.00 | 11-20-2025 | cancelled
 153 |      54 | 601.00 | 11-19-2025 | completed
 154 |      55 | 618.00 | 11-18-2025 | pending
 155 |      56 | 635.00 | 11-17-2025 | cancelled
 156 |      57 | 652.00 | 11-16-2025 | completed
 180 |      81 |  60.00 | 11-22-2025 | completed
 181 |      82 |  77.00 | 11-21-2025 | pending
 182 |      83 |  94.00 | 11-20-2025 | cancelled
 183 |      84 | 111.00 | 11-19-2025 | completed
 184 |      85 | 128.00 | 11-18-2025 | pending
 185 |      86 | 145.00 | 11-17-2025 | cancelled
 186 |      87 | 162.00 | 11-16-2025 | completed
 210 |      11 | 570.00 | 11-22-2025 | completed
 211 |      12 | 587.00 | 11-21-2025 | pending
 212 |      13 | 604.00 | 11-20-2025 | cancelled
 213 |      14 | 621.00 | 11-19-2025 | completed
 214 |      15 | 638.00 | 11-18-2025 | pending
 215 |      16 | 655.00 | 11-17-2025 | cancelled
 216 |      17 | 672.00 | 11-16-2025 | completed
 240 |      41 |  80.00 | 11-22-2025 | completed
 241 |      42 |  97.00 | 11-21-2025 | pending
 242 |      43 | 114.00 | 11-20-2025 | cancelled
 243 |      44 | 131.00 | 11-19-2025 | completed
 244 |      45 | 148.00 | 11-18-2025 | pending
 245 |      46 | 165.00 | 11-17-2025 | cancelled
 246 |      47 | 182.00 | 11-16-2025 | completed
 270 |      71 | 590.00 | 11-22-2025 | completed
 271 |      72 | 607.00 | 11-21-2025 | pending
 272 |      73 | 624.00 | 11-20-2025 | cancelled
 273 |      74 | 641.00 | 11-19-2025 | completed
 274 |      75 | 658.00 | 11-18-2025 | pending
 275 |      76 | 675.00 | 11-17-2025 | cancelled
 276 |      77 | 692.00 | 11-16-2025 | completed
 300 |       1 | 100.00 | 11-22-2025 | completed
 301 |       2 | 117.00 | 11-21-2025 | pending
 302 |       3 | 134.00 | 11-20-2025 | cancelled
 303 |       4 | 151.00 | 11-19-2025 | completed
 304 |       5 | 168.00 | 11-18-2025 | pending
 305 |       6 | 185.00 | 11-17-2025 | cancelled
 306 |       7 | 202.00 | 11-16-2025 | completed
 330 |      31 | 610.00 | 11-22-2025 | completed
 331 |      32 | 627.00 | 11-21-2025 | pending
 332 |      33 | 644.00 | 11-20-2025 | cancelled
 333 |      34 | 661.00 | 11-19-2025 | completed
 334 |      35 | 678.00 | 11-18-2025 | pending
 335 |      36 | 695.00 | 11-17-2025 | cancelled
 336 |      37 | 712.00 | 11-16-2025 | completed
 360 |      61 | 120.00 | 11-22-2025 | completed
 361 |      62 | 137.00 | 11-21-2025 | pending
 362 |      63 | 154.00 | 11-20-2025 | cancelled
 363 |      64 | 171.00 | 11-19-2025 | completed
 364 |      65 | 188.00 | 11-18-2025 | pending
 365 |      66 | 205.00 | 11-17-2025 | cancelled
 366 |      67 | 222.00 | 11-16-2025 | completed
 390 |      91 | 630.00 | 11-22-2025 | completed
 391 |      92 | 647.00 | 11-21-2025 | pending
 392 |      93 | 664.00 | 11-20-2025 | cancelled
 393 |      94 | 681.00 | 11-19-2025 | completed
 394 |      95 | 698.00 | 11-18-2025 | pending
 395 |      96 | 715.00 | 11-17-2025 | cancelled
 396 |      97 | 732.00 | 11-16-2025 | completed
 420 |      21 | 140.00 | 11-22-2025 | completed
 421 |      22 | 157.00 | 11-21-2025 | pending
 422 |      23 | 174.00 | 11-20-2025 | cancelled
 423 |      24 | 191.00 | 11-19-2025 | completed
 424 |      25 | 208.00 | 11-18-2025 | pending
 425 |      26 | 225.00 | 11-17-2025 | cancelled
 426 |      27 | 242.00 | 11-16-2025 | completed
 450 |      51 | 650.00 | 11-22-2025 | completed
 451 |      52 | 667.00 | 11-21-2025 | pending
 452 |      53 | 684.00 | 11-20-2025 | cancelled
 453 |      54 | 701.00 | 11-19-2025 | completed
 454 |      55 | 718.00 | 11-18-2025 | pending
 455 |      56 | 735.00 | 11-17-2025 | cancelled
 456 |      57 | 752.00 | 11-16-2025 | completed
 480 |      81 | 160.00 | 11-22-2025 | completed
 481 |      82 | 177.00 | 11-21-2025 | pending
 482 |      83 | 194.00 | 11-20-2025 | cancelled
 483 |      84 | 211.00 | 11-19-2025 | completed
 484 |      85 | 228.00 | 11-18-2025 | pending
 485 |      86 | 245.00 | 11-17-2025 | cancelled
 486 |      87 | 262.00 | 11-16-2025 | completed
 510 |      11 | 670.00 | 11-22-2025 | completed
 511 |      12 | 687.00 | 11-21-2025 | pending
 512 |      13 | 704.00 | 11-20-2025 | cancelled
 513 |      14 | 721.00 | 11-19-2025 | completed
 514 |      15 | 738.00 | 11-18-2025 | pending
 515 |      16 | 755.00 | 11-17-2025 | cancelled
 516 |      17 | 772.00 | 11-16-2025 | completed
 540 |      41 | 180.00 | 11-22-2025 | completed
 541 |      42 | 197.00 | 11-21-2025 | pending
 542 |      43 | 214.00 | 11-20-2025 | cancelled
 543 |      44 | 231.00 | 11-19-2025 | completed
 544 |      45 | 248.00 | 11-18-2025 | pending
 545 |      46 | 265.00 | 11-17-2025 | cancelled
 546 |      47 | 282.00 | 11-16-2025 | completed
 570 |      71 | 690.00 | 11-22-2025 | completed
 571 |      72 | 707.00 | 11-21-2025 | pending
 572 |      73 | 724.00 | 11-20-2025 | cancelled
 573 |      74 | 741.00 | 11-19-2025 | completed
 574 |      75 | 758.00 | 11-18-2025 | pending
 575 |      76 | 775.00 | 11-17-2025 | cancelled
 576 |      77 | 792.00 | 11-16-2025 | completed
 600 |       1 | 200.00 | 11-22-2025 | completed
 601 |       2 | 217.00 | 11-21-2025 | pending
 602 |       3 | 234.00 | 11-20-2025 | cancelled
 603 |       4 | 251.00 | 11-19-2025 | completed
 604 |       5 | 268.00 | 11-18-2025 | pending
 605 |       6 | 285.00 | 11-17-2025 | cancelled
 606 |       7 | 302.00 | 11-16-2025 | completed
 630 |      31 | 710.00 | 11-22-2025 | completed
 631 |      32 | 727.00 | 11-21-2025 | pending
 632 |      33 | 744.00 | 11-20-2025 | cancelled
 633 |      34 | 761.00 | 11-19-2025 | completed
 634 |      35 | 778.00 | 11-18-2025 | pending
 635 |      36 | 795.00 | 11-17-2025 | cancelled
 636 |      37 | 812.00 | 11-16-2025 | completed
 660 |      61 | 220.00 | 11-22-2025 | completed
 661 |      62 | 237.00 | 11-21-2025 | pending
 662 |      63 | 254.00 | 11-20-2025 | cancelled
 663 |      64 | 271.00 | 11-19-2025 | completed
 664 |      65 | 288.00 | 11-18-2025 | pending
 665 |      66 | 305.00 | 11-17-2025 | cancelled
 666 |      67 | 322.00 | 11-16-2025 | completed
 690 |      91 | 730.00 | 11-22-2025 | completed
 691 |      92 | 747.00 | 11-21-2025 | pending
 692 |      93 | 764.00 | 11-20-2025 | cancelled
 693 |      94 | 781.00 | 11-19-2025 | completed
 694 |      95 | 798.00 | 11-18-2025 | pending
 695 |      96 | 815.00 | 11-17-2025 | cancelled
 696 |      97 | 832.00 | 11-16-2025 | completed
 720 |      21 | 240.00 | 11-22-2025 | completed
 721 |      22 | 257.00 | 11-21-2025 | pending
 722 |      23 | 274.00 | 11-20-2025 | cancelled
 723 |      24 | 291.00 | 11-19-2025 | completed
 724 |      25 | 308.00 | 11-18-2025 | pending
 725 |      26 | 325.00 | 11-17-2025 | cancelled
 726 |      27 | 342.00 | 11-16-2025 | completed
 750 |      51 | 750.00 | 11-22-2025 | completed
 751 |      52 | 767.00 | 11-21-2025 | pending
 752 |      53 | 784.00 | 11-20-2025 | cancelled
 753 |      54 | 801.00 | 11-19-2025 | completed
 754 |      55 | 818.00 | 11-18-2025 | pending
 755 |      56 | 835.00 | 11-17-2025 | cancelled
 756 |      57 | 852.00 | 11-16-2025 | completed
 780 |      81 | 260.00 | 11-22-2025 | completed
 781 |      82 | 277.00 | 11-21-2025 | pending
 782 |      83 | 294.00 | 11-20-2025 | cancelled
 783 |      84 | 311.00 | 11-19-2025 | completed
 784 |      85 | 328.00 | 11-18-2025 | pending
 785 |      86 | 345.00 | 11-17-2025 | cancelled
 786 |      87 | 362.00 | 11-16-2025 | completed
 810 |      11 | 770.00 | 11-22-2025 | completed
 811 |      12 | 787.00 | 11-21-2025 | pending
 812 |      13 | 804.00 | 11-20-2025 | cancelled
 813 |      14 | 821.00 | 11-19-2025 | completed
 814 |      15 | 838.00 | 11-18-2025 | pending
 815 |      16 | 855.00 | 11-17-2025 | cancelled
 816 |      17 | 872.00 | 11-16-2025 | completed
 840 |      41 | 280.00 | 11-22-2025 | completed
 841 |      42 | 297.00 | 11-21-2025 | pending
 842 |      43 | 314.00 | 11-20-2025 | cancelled
 843 |      44 | 331.00 | 11-19-2025 | completed
 844 |      45 | 348.00 | 11-18-2025 | pending
 845 |      46 | 365.00 | 11-17-2025 | cancelled
 846 |      47 | 382.00 | 11-16-2025 | completed
 870 |      71 | 790.00 | 11-22-2025 | completed
 871 |      72 | 807.00 | 11-21-2025 | pending
 872 |      73 | 824.00 | 11-20-2025 | cancelled
 873 |      74 | 841.00 | 11-19-2025 | completed
 874 |      75 | 858.00 | 11-18-2025 | pending
 875 |      76 | 875.00 | 11-17-2025 | cancelled
 876 |      77 | 892.00 | 11-16-2025 | completed
 900 |       1 | 300.00 | 11-22-2025 | completed
 901 |       2 | 317.00 | 11-21-2025 | pending
 902 |       3 | 334.00 | 11-20-2025 | cancelled
 903 |       4 | 351.00 | 11-19-2025 | completed
 904 |       5 | 368.00 | 11-18-2025 | pending
 905 |       6 | 385.00 | 11-17-2025 | cancelled
 906 |       7 | 402.00 | 11-16-2025 | completed
 930 |      31 | 810.00 | 11-22-2025 | completed
 931 |      32 | 827.00 | 11-21-2025 | pending
 932 |      33 | 844.00 | 11-20-2025 | cancelled
 933 |      34 | 861.00 | 11-19-2025 | completed
 934 |      35 | 878.00 | 11-18-2025 | pending
 935 |      36 | 895.00 | 11-17-2025 | cancelled
 936 |      37 | 912.00 | 11-16-2025 | completed
 960 |      61 | 320.00 | 11-22-2025 | completed
 961 |      62 | 337.00 | 11-21-2025 | pending
 962 |      63 | 354.00 | 11-20-2025 | cancelled
 963 |      64 | 371.00 | 11-19-2025 | completed
 964 |      65 | 388.00 | 11-18-2025 | pending
 965 |      66 | 405.00 | 11-17-2025 | cancelled
 966 |      67 | 422.00 | 11-16-2025 | completed
 990 |      91 | 830.00 | 11-22-2025 | completed
 991 |      92 | 847.00 | 11-21-2025 | pending
 992 |      93 | 864.00 | 11-20-2025 | cancelled
 993 |      94 | 881.00 | 11-19-2025 | completed
 994 |      95 | 898.00 | 11-18-2025 | pending
 995 |      96 | 915.00 | 11-17-2025 | cancelled
 996 |      97 | 932.00 | 11-16-2025 | completed
(237 rows)

SELECT * FROM idx_test_orders WHERE status = 'completed' ORDER BY id;
 id  | user_id | amount | order_date |  status   
-----+---------+--------+------------+-----------
   3 |       4 |  51.00 | 11-19-2025 | completed
   6 |       7 | 102.00 | 11-16-2025 | completed
   9 |      10 | 153.00 | 11-13-2025 | completed
  12 |      13 | 204.00 | 11-10-2025 | completed
  15 |      16 | 255.00 | 11-07-2025 | completed
  18 |      19 | 306.00 | 11-04-2025 | completed
  21 |      22 | 357.00 | 11-01-2025 | completed
  24 |      25 | 408.00 | 10-29-2025 | completed
  27 |      28 | 459.00 | 10-26-2025 | completed
  30 |      31 | 510.00 | 11-22-2025 | completed
  33 |      34 | 561.00 | 11-19-2025 | completed
  36 |      37 | 612.00 | 11-16-2025 | completed
  39 |      40 | 663.00 | 11-13-2025 | completed
  42 |      43 | 714.00 | 11-10-2025 | completed
  45 |      46 | 765.00 | 11-07-2025 | completed
  48 |      49 | 816.00 | 11-04-2025 | completed
  51 |      52 | 867.00 | 11-01-2025 | completed
  54 |      55 | 918.00 | 10-29-2025 | completed
  57 |      58 | 969.00 | 10-26-2025 | completed
  60 |      61 |  20.00 | 11-22-2025 | completed
  63 |      64 |  71.00 | 11-19-2025 | completed
  66 |      67 | 122.00 | 11-16-2025 | completed
  69 |      70 | 173.00 | 11-13-2025 | completed
  72 |      73 | 224.00 | 11-10-2025 | completed
  75 |      76 | 275.00 | 11-07-2025 | completed
  78 |      79 | 326.00 | 11-04-2025 | completed
  81 |      82 | 377.00 | 11-01-2025 | completed
  84 |      85 | 428.00 | 10-29-2025 | completed
  87 |      88 | 479.00 | 10-26-2025 | completed
  90 |      91 | 530.00 | 11-22-2025 | completed
  93 |      94 | 581.00 | 11-19-2025 | completed
  96 |      97 | 632.00 | 11-16-2025 | completed
  99 |     100 | 683.00 | 11-13-2025 | completed
 102 |       3 | 734.00 | 11-10-2025 | completed
 105 |       6 | 785.00 | 11-07-2025 | completed
 108 |       9 | 836.00 | 11-04-2025 | completed
 111 |      12 | 887.00 | 11-01-2025 | completed
 114 |      15 | 938.00 | 10-29-2025 | completed
 117 |      18 | 989.00 | 10-26-2025 | completed
 120 |      21 |  40.00 | 11-22-2025 | completed
 123 |      24 |  91.00 | 11-19-2025 | completed
 126 |      27 | 142.00 | 11-16-2025 | completed
 129 |      30 | 193.00 | 11-13-2025 | completed
 132 |      33 | 244.00 | 11-10-2025 | completed
 135 |      36 | 295.00 | 11-07-2025 | completed
 138 |      39 | 346.00 | 11-04-2025 | completed
 141 |      42 | 397.00 | 11-01-2025 | completed
 144 |      45 | 448.00 | 10-29-2025 | completed
 147 |      48 | 499.00 | 10-26-2025 | completed
 150 |      51 | 550.00 | 11-22-2025 | completed
 153 |      54 | 601.00 | 11-19-2025 | completed
 156 |      57 | 652.00 | 11-16-2025 | completed
 159 |      60 | 703.00 | 11-13-2025 | completed
 162 |      63 | 754.00 | 11-10-2025 | completed
 165 |      66 | 805.00 | 11-07-2025 | completed
 168 |      69 | 856.00 | 11-04-2025 | completed
 171 |      72 | 907.00 | 11-01-2025 | completed
 174 |      75 | 958.00 | 10-29-2025 | completed
 177 |      78 |   9.00 | 10-26-2025 | completed
 180 |      81 |  60.00 | 11-22-2025 | completed
 183 |      84 | 111.00 | 11-19-2025 | completed
 186 |      87 | 162.00 | 11-16-2025 | completed
 189 |      90 | 213.00 | 11-13-2025 | completed
 192 |      93 | 264.00 | 11-10-2025 | completed
 195 |      96 | 315.00 | 11-07-2025 | completed
 198 |      99 | 366.00 | 11-04-2025 | completed
 201 |       2 | 417.00 | 11-01-2025 | completed
 204 |       5 | 468.00 | 10-29-2025 | completed
 207 |       8 | 519.00 | 10-26-2025 | completed
 210 |      11 | 570.00 | 11-22-2025 | completed
 213 |      14 | 621.00 | 11-19-2025 | completed
 216 |      17 | 672.00 | 11-16-2025 | completed
 219 |      20 | 723.00 | 11-13-2025 | completed
 222 |      23 | 774.00 | 11-10-2025 | completed
 225 |      26 | 825.00 | 11-07-2025 | completed
 228 |      29 | 876.00 | 11-04-2025 | completed
 231 |      32 | 927.00 | 11-01-2025 | completed
 234 |      35 | 978.00 | 10-29-2025 | completed
 237 |      38 |  29.00 | 10-26-2025 | completed
 240 |      41 |  80.00 | 11-22-2025 | completed
 243 |      44 | 131.00 | 11-19-2025 | completed
 246 |      47 | 182.00 | 11-16-2025 | completed
 249 |      50 | 233.00 | 11-13-2025 | completed
 252 |      53 | 284.00 | 11-10-2025 | completed
 255 |      56 | 335.00 | 11-07-2025 | completed
 258 |      59 | 386.00 | 11-04-2025 | completed
 261 |      62 | 437.00 | 11-01-2025 | completed
 264 |      65 | 488.00 | 10-29-2025 | completed
 267 |      68 | 539.00 | 10-26-2025 | completed
 270 |      71 | 590.00 | 11-22-2025 | completed
 273 |      74 | 641.00 | 11-19-2025 | completed
 276 |      77 | 692.00 | 11-16-2025 | completed
 279 |      80 | 743.00 | 11-13-2025 | completed
 282 |      83 | 794.00 | 11-10-2025 | completed
 285 |      86 | 845.00 | 11-07-2025 | completed
 288 |      89 | 896.00 | 11-04-2025 | completed
 291 |      92 | 947.00 | 11-01-2025 | completed
 294 |      95 | 998.00 | 10-29-2025 | completed
 297 |      98 |  49.00 | 10-26-2025 | completed
 300 |       1 | 100.00 | 11-22-2025 | completed
 303 |       4 | 151.00 | 11-19-2025 | completed
 306 |       7 | 202.00 | 11-16-2025 | completed
 309 |      10 | 253.00 | 11-13-2025 | completed
 312 |      13 | 304.00 | 11-10-2025 | completed
 315 |      16 | 355.00 | 11-07-2025 | completed
 318 |      19 | 406.00 | 11-04-2025 | completed
 321 |      22 | 457.00 | 11-01-2025 | completed
 324 |      25 | 508.00 | 10-29-2025 | completed
 327 |      28 | 559.00 | 10-26-2025 | completed
 330 |      31 | 610.00 | 11-22-2025 | completed
 333 |      34 | 661.00 | 11-19-2025 | completed
 336 |      37 | 712.00 | 11-16-2025 | completed
 339 |      40 | 763.00 | 11-13-2025 | completed
 342 |      43 | 814.00 | 11-10-2025 | completed
 345 |      46 | 865.00 | 11-07-2025 | completed
 348 |      49 | 916.00 | 11-04-2025 | completed
 351 |      52 | 967.00 | 11-01-2025 | completed
 354 |      55 |  18.00 | 10-29-2025 | completed
 357 |      58 |  69.00 | 10-26-2025 | completed
 360 |      61 | 120.00 | 11-22-2025 | completed
 363 |      64 | 171.00 | 11-19-2025 | completed
 366 |      67 | 222.00 | 11-16-2025 | completed
 369 |      70 | 273.00 | 11-13-2025 | completed
 372 |      73 | 324.00 | 11-10-2025 | completed
 375 |      76 | 375.00 | 11-07-2025 | completed
 378 |      79 | 426.00 | 11-04-2025 | completed
 381 |      82 | 477.00 | 11-01-2025 | completed
 384 |      85 | 528.00 | 10-29-2025 | completed
 387 |      88 | 579.00 | 10-26-2025 | completed
 390 |      91 | 630.00 | 11-22-2025 | completed
 393 |      94 | 681.00 | 11-19-2025 | completed
 396 |      97 | 732.00 | 11-16-2025 | completed
 399 |     100 | 783.00 | 11-13-2025 | completed
 402 |       3 | 834.00 | 11-10-2025 | completed
 405 |       6 | 885.00 | 11-07-2025 | completed
 408 |       9 | 936.00 | 11-04-2025 | completed
 411 |      12 | 987.00 | 11-01-2025 | completed
 414 |      15 |  38.00 | 10-29-2025 | completed
 417 |      18 |  89.00 | 10-26-2025 | completed
 420 |      21 | 140.00 | 11-22-2025 | completed
 423 |      24 | 191.00 | 11-19-2025 | completed
 426 |      27 | 242.00 | 11-16-2025 | completed
 429 |      30 | 293.00 | 11-13-2025 | completed
 432 |      33 | 344.00 | 11-10-2025 | completed
 435 |      36 | 395.00 | 11-07-2025 | completed
 438 |      39 | 446.00 | 11-04-2025 | completed
 441 |      42 | 497.00 | 11-01-2025 | completed
 444 |      45 | 548.00 | 10-29-2025 | completed
 447 |      48 | 599.00 | 10-26-2025 | completed
 450 |      51 | 650.00 | 11-22-2025 | completed
 453 |      54 | 701.00 | 11-19-2025 | completed
 456 |      57 | 752.00 | 11-16-2025 | completed
 459 |      60 | 803.00 | 11-13-2025 | completed
 462 |      63 | 854.00 | 11-10-2025 | completed
 465 |      66 | 905.00 | 11-07-2025 | completed
 468 |      69 | 956.00 | 11-04-2025 | completed
 471 |      72 |   7.00 | 11-01-2025 | completed
 474 |      75 |  58.00 | 10-29-2025 | completed
 477 |      78 | 109.00 | 10-26-2025 | completed
 480 |      81 | 160.00 | 11-22-2025 | completed
 483 |      84 | 211.00 | 11-19-2025 | completed
 486 |      87 | 262.00 | 11-16-2025 | completed
 489 |      90 | 313.00 | 11-13-2025 | completed
 492 |      93 | 364.00 | 11-10-2025 | completed
 495 |      96 | 415.00 | 11-07-2025 | completed
 498 |      99 | 466.00 | 11-04-2025 | completed
 501 |       2 | 517.00 | 11-01-2025 | completed
 504 |       5 | 568.00 | 10-29-2025 | completed
 507 |       8 | 619.00 | 10-26-2025 | completed
 510 |      11 | 670.00 | 11-22-2025 | completed
 513 |      14 | 721.00 | 11-19-2025 | completed
 516 |      17 | 772.00 | 11-16-2025 | completed
 519 |      20 | 823.00 | 11-13-2025 | completed
 522 |      23 | 874.00 | 11-10-2025 | completed
 525 |      26 | 925.00 | 11-07-2025 | completed
 528 |      29 | 976.00 | 11-04-2025 | completed
 531 |      32 |  27.00 | 11-01-2025 | completed
 534 |      35 |  78.00 | 10-29-2025 | completed
 537 |      38 | 129.00 | 10-26-2025 | completed
 540 |      41 | 180.00 | 11-22-2025 | completed
 543 |      44 | 231.00 | 11-19-2025 | completed
 546 |      47 | 282.00 | 11-16-2025 | completed
 549 |      50 | 333.00 | 11-13-2025 | completed
 552 |      53 | 384.00 | 11-10-2025 | completed
 555 |      56 | 435.00 | 11-07-2025 | completed
 558 |      59 | 486.00 | 11-04-2025 | completed
 561 |      62 | 537.00 | 11-01-2025 | completed
 564 |      65 | 588.00 | 10-29-2025 | completed
 567 |      68 | 639.00 | 10-26-2025 | completed
 570 |      71 | 690.00 | 11-22-2025 | completed
 573 |      74 | 741.00 | 11-19-2025 | completed
 576 |      77 | 792.00 | 11-16-2025 | completed
 579 |      80 | 843.00 | 11-13-2025 | completed
 582 |      83 | 894.00 | 11-10-2025 | completed
 585 |      86 | 945.00 | 11-07-2025 | completed
 588 |      89 | 996.00 | 11-04-2025 | completed
 591 |      92 |  47.00 | 11-01-2025 | completed
 594 |      95 |  98.00 | 10-29-2025 | completed
 597 |      98 | 149.00 | 10-26-2025 | completed
 600 |       1 | 200.00 | 11-22-2025 | completed
 603 |       4 | 251.00 | 11-19-2025 | completed
 606 |       7 | 302.00 | 11-16-2025 | completed
 609 |      10 | 353.00 | 11-13-2025 | completed
 612 |      13 | 404.00 | 11-10-2025 | completed
 615 |      16 | 455.00 | 11-07-2025 | completed
 618 |      19 | 506.00 | 11-04-2025 | completed
 621 |      22 | 557.00 | 11-01-2025 | completed
 624 |      25 | 608.00 | 10-29-2025 | completed
 627 |      28 | 659.00 | 10-26-2025 | completed
 630 |      31 | 710.00 | 11-22-2025 | completed
 633 |      34 | 761.00 | 11-19-2025 | completed
 636 |      37 | 812.00 | 11-16-2025 | completed
 639 |      40 | 863.00 | 11-13-2025 | completed
 642 |      43 | 914.00 | 11-10-2025 | completed
 645 |      46 | 965.00 | 11-07-2025 | completed
 648 |      49 |  16.00 | 11-04-2025 | completed
 651 |      52 |  67.00 | 11-01-2025 | completed
 654 |      55 | 118.00 | 10-29-2025 | completed
 657 |      58 | 169.00 | 10-26-2025 | completed
 660 |      61 | 220.00 | 11-22-2025 | completed
 663 |      64 | 271.00 | 11-19-2025 | completed
 666 |      67 | 322.00 | 11-16-2025 | completed
 669 |      70 | 373.00 | 11-13-2025 | completed
 672 |      73 | 424.00 | 11-10-2025 | completed
 675 |      76 | 475.00 | 11-07-2025 | completed
 678 |      79 | 526.00 | 11-04-2025 | completed
 681 |      82 | 577.00 | 11-01-2025 | completed
 684 |      85 | 628.00 | 10-29-2025 | completed
 687 |      88 | 679.00 | 10-26-2025 | completed
 690 |      91 | 730.00 | 11-22-2025 | completed
 693 |      94 | 781.00 | 11-19-2025 | completed
 696 |      97 | 832.00 | 11-16-2025 | completed
 699 |     100 | 883.00 | 11-13-2025 | completed
 702 |       3 | 934.00 | 11-10-2025 | completed
 705 |       6 | 985.00 | 11-07-2025 | completed
 708 |       9 |  36.00 | 11-04-2025 | completed
 711 |      12 |  87.00 | 11-01-2025 | completed
 714 |      15 | 138.00 | 10-29-2025 | completed
 717 |      18 | 189.00 | 10-26-2025 | completed
 720 |      21 | 240.00 | 11-22-2025 | completed
 723 |      24 | 291.00 | 11-19-2025 | completed
 726 |      27 | 342.00 | 11-16-2025 | completed
 729 |      30 | 393.00 | 11-13-2025 | completed
 732 |      33 | 444.00 | 11-10-2025 | completed
 735 |      36 | 495.00 | 11-07-2025 | completed
 738 |      39 | 546.00 | 11-04-2025 | completed
 741 |      42 | 597.00 | 11-01-2025 | completed
 744 |      45 | 648.00 | 10-29-2025 | completed
 747 |      48 | 699.00 | 10-26-2025 | completed
 750 |      51 | 750.00 | 11-22-2025 | completed
 753 |      54 | 801.00 | 11-19-2025 | completed
 756 |      57 | 852.00 | 11-16-2025 | completed
 759 |      60 | 903.00 | 11-13-2025 | completed
 762 |      63 | 954.00 | 11-10-2025 | completed
 765 |      66 |   5.00 | 11-07-2025 | completed
 768 |      69 |  56.00 | 11-04-2025 | completed
 771 |      72 | 107.00 | 11-01-2025 | completed
 774 |      75 | 158.00 | 10-29-2025 | completed
 777 |      78 | 209.00 | 10-26-2025 | completed
 780 |      81 | 260.00 | 11-22-2025 | completed
 783 |      84 | 311.00 | 11-19-2025 | completed
 786 |      87 | 362.00 | 11-16-2025 | completed
 789 |      90 | 413.00 | 11-13-2025 | completed
 792 |      93 | 464.00 | 11-10-2025 | completed
 795 |      96 | 515.00 | 11-07-2025 | completed
 798 |      99 | 566.00 | 11-04-2025 | completed
 801 |       2 | 617.00 | 11-01-2025 | completed
 804 |       5 | 668.00 | 10-29-2025 | completed
 807 |       8 | 719.00 | 10-26-2025 | completed
 810 |      11 | 770.00 | 11-22-2025 | completed
 813 |      14 | 821.00 | 11-19-2025 | completed
 816 |      17 | 872.00 | 11-16-2025 | completed
 819 |      20 | 923.00 | 11-13-2025 | completed
 822 |      23 | 974.00 | 11-10-2025 | completed
 825 |      26 |  25.00 | 11-07-2025 | completed
 828 |      29 |  76.00 | 11-04-2025 | completed
 831 |      32 | 127.00 | 11-01-2025 | completed
 834 |      35 | 178.00 | 10-29-2025 | completed
 837 |      38 | 229.00 | 10-26-2025 | completed
 840 |      41 | 280.00 | 11-22-2025 | completed
 843 |      44 | 331.00 | 11-19-2025 | completed
 846 |      47 | 382.00 | 11-16-2025 | completed
 849 |      50 | 433.00 | 11-13-2025 | completed
 852 |      53 | 484.00 | 11-10-2025 | completed
 855 |      56 | 535.00 | 11-07-2025 | completed
 858 |      59 | 586.00 | 11-04-2025 | completed
 861 |      62 | 637.00 | 11-01-2025 | completed
 864 |      65 | 688.00 | 10-29-2025 | completed
 867 |      68 | 739.00 | 10-26-2025 | completed
 870 |      71 | 790.00 | 11-22-2025 | completed
 873 |      74 | 841.00 | 11-19-2025 | completed
 876 |      77 | 892.00 | 11-16-2025 | completed
 879 |      80 | 943.00 | 11-13-2025 | completed
 882 |      83 | 994.00 | 11-10-2025 | completed
 885 |      86 |  45.00 | 11-07-2025 | completed
 888 |      89 |  96.00 | 11-04-2025 | completed
 891 |      92 | 147.00 | 11-01-2025 | completed
 894 |      95 | 198.00 | 10-29-2025 | completed
 897 |      98 | 249.00 | 10-26-2025 | completed
 900 |       1 | 300.00 | 11-22-2025 | completed
 903 |       4 | 351.00 | 11-19-2025 | completed
 906 |       7 | 402.00 | 11-16-2025 | completed
 909 |      10 | 453.00 | 11-13-2025 | completed
 912 |      13 | 504.00 | 11-10-2025 | completed
 915 |      16 | 555.00 | 11-07-2025 | completed
 918 |      19 | 606.00 | 11-04-2025 | completed
 921 |      22 | 657.00 | 11-01-2025 | completed
 924 |      25 | 708.00 | 10-29-2025 | completed
 927 |      28 | 759.00 | 10-26-2025 | completed
 930 |      31 | 810.00 | 11-22-2025 | completed
 933 |      34 | 861.00 | 11-19-2025 | completed
 936 |      37 | 912.00 | 11-16-2025 | completed
 939 |      40 | 963.00 | 11-13-2025 | completed
 942 |      43 |  14.00 | 11-10-2025 | completed
 945 |      46 |  65.00 | 11-07-2025 | completed
 948 |      49 | 116.00 | 11-04-2025 | completed
 951 |      52 | 167.00 | 11-01-2025 | completed
 954 |      55 | 218.00 | 10-29-2025 | completed
 957 |      58 | 269.00 | 10-26-2025 | completed
 960 |      61 | 320.00 | 11-22-2025 | completed
 963 |      64 | 371.00 | 11-19-2025 | completed
 966 |      67 | 422.00 | 11-16-2025 | completed
 969 |      70 | 473.00 | 11-13-2025 | completed
 972 |      73 | 524.00 | 11-10-2025 | completed
 975 |      76 | 575.00 | 11-07-2025 | completed
 978 |      79 | 626.00 | 11-04-2025 | completed
 981 |      82 | 677.00 | 11-01-2025 | completed
 984 |      85 | 728.00 | 10-29-2025 | completed
 987 |      88 | 779.00 | 10-26-2025 | completed
 990 |      91 | 830.00 | 11-22-2025 | completed
 993 |      94 | 881.00 | 11-19-2025 | completed
 996 |      97 | 932.00 | 11-16-2025 | completed
 999 |     100 | 983.00 | 11-13-2025 | completed
(333 rows)

-- Test 1: Verify all index views exist
SELECT 
    'All index views exist' AS test_name,
    CASE 
        WHEN count(*) >= 9 THEN 'PASS'
        ELSE 'FAIL: Expected at least 9 views, found ' || count(*)
    END AS result
FROM pg_views 
WHERE viewname IN (
    'pg_stat_insights_indexes',
    'pg_stat_insights_index_usage',
    'pg_stat_insights_index_bloat',
    'pg_stat_insights_index_efficiency',
    'pg_stat_insights_index_maintenance',
    'pg_stat_insights_index_summary',
    'pg_stat_insights_index_alerts',
    'pg_stat_insights_index_dashboard',
    'pg_stat_insights_missing_indexes',
    'pg_stat_insights_index_maintenance_history',
    'pg_stat_insights_index_duplicates'
);
       test_name       | result 
-----------------------+--------
 All index views exist | PASS
(1 row)

-- Test 2: pg_stat_insights_indexes - Basic functionality
SELECT 
    'pg_stat_insights_indexes has data' AS test_name,
    CASE 
        WHEN count(*) > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
             test_name             | result 
-----------------------------------+--------
 pg_stat_insights_indexes has data | PASS
(1 row)

-- Test 3: Index size metrics
SELECT 
    'Index size metrics valid' AS test_name,
    CASE 
        WHEN count(*) > 0 AND 
             min(index_size_bytes) >= 0 AND 
             min(index_size_mb) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
        test_name         | result 
--------------------------+--------
 Index size metrics valid | PASS
(1 row)

-- Test 4: Index type detection
SELECT 
    'Index type detection works' AS test_name,
    CASE 
        WHEN count(*) > 0 AND 
             count(*) FILTER (WHERE index_type = 'btree') > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
         test_name          | result 
----------------------------+--------
 Index type detection works | PASS
(1 row)

-- Test 5: Index properties
SELECT 
    'Index properties detected' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE is_primary = true) > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
         test_name         | result 
---------------------------+--------
 Index properties detected | PASS
(1 row)

-- Test 6: pg_stat_insights_index_usage - Usage analysis
SELECT 
    'Index usage view has data' AS test_name,
    CASE 
        WHEN count(*) > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_usage
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
         test_name         | result 
---------------------------+--------
 Index usage view has data | PASS
(1 row)

-- Test 7: Usage status classification
SELECT 
    'Usage status classification works' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE usage_status IN ('ACTIVE', 'HEAVY', 'OCCASIONAL', 'RARE', 'NEVER_USED')) > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_usage
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
             test_name             | result 
-----------------------------------+--------
 Usage status classification works | PASS
(1 row)

-- Test 8: Index scan ratio
SELECT 
    'Index scan ratio valid' AS test_name,
    CASE 
        WHEN count(*) > 0 AND 
             min(index_scan_ratio) >= 0 AND 
             max(index_scan_ratio) <= 1 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_usage
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
       test_name        | result 
------------------------+--------
 Index scan ratio valid | PASS
(1 row)

-- Test 9: pg_stat_insights_index_bloat - Bloat detection
SELECT 
    'Index bloat view accessible' AS test_name,
    CASE 
        WHEN count(*) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_bloat
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
          test_name          | result 
-----------------------------+--------
 Index bloat view accessible | PASS
(1 row)

-- Test 10: Bloat severity
SELECT 
    'Bloat severity classification works' AS test_name,
    CASE 
        WHEN count(*) >= 0 AND 
             count(*) FILTER (WHERE bloat_severity IN ('NONE', 'LOW', 'MEDIUM', 'HIGH')) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_bloat
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
              test_name              | result 
-------------------------------------+--------
 Bloat severity classification works | PASS
(1 row)

-- Test 11: pg_stat_insights_index_efficiency - Efficiency analysis
SELECT 
    'Index efficiency view has data' AS test_name,
    CASE 
        WHEN count(*) > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_efficiency
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
           test_name            | result 
--------------------------------+--------
 Index efficiency view has data | PASS
(1 row)

-- Test 12: Efficiency rating
SELECT 
    'Efficiency rating calculated' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE efficiency_rating IN ('EXCELLENT', 'GOOD', 'FAIR', 'POOR', 'UNUSED')) > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_efficiency
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
          test_name           | result 
------------------------------+--------
 Efficiency rating calculated | PASS
(1 row)

-- Test 13: pg_stat_insights_index_maintenance - Maintenance recommendations
SELECT 
    'Index maintenance view has data' AS test_name,
    CASE 
        WHEN count(*) > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_maintenance
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
            test_name            | result 
---------------------------------+--------
 Index maintenance view has data | PASS
(1 row)

-- Test 14: Maintenance type
SELECT 
    'Maintenance type detected' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE maintenance_type IN ('REINDEX', 'VACUUM', 'ANALYZE', 'NONE')) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_maintenance
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
         test_name         | result 
---------------------------+--------
 Maintenance type detected | PASS
(1 row)

-- Test 15: pg_stat_insights_index_summary - Summary view
SELECT 
    'Index summary view accessible' AS test_name,
    CASE 
        WHEN total_indexes > 0 AND total_index_size_mb >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_summary;
           test_name           | result 
-------------------------------+--------
 Index summary view accessible | PASS
(1 row)

-- Test 16: Summary metrics
SELECT 
    'Summary metrics calculated' AS test_name,
    CASE 
        WHEN active_indexes >= 0 AND unused_indexes >= 0 AND bloated_indexes >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_summary;
         test_name          | result 
----------------------------+--------
 Summary metrics calculated | PASS
(1 row)

-- Test 17: pg_stat_insights_index_alerts - Alerts
SELECT 
    'Index alerts view accessible' AS test_name,
    CASE 
        WHEN count(*) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_alerts;
          test_name           | result 
------------------------------+--------
 Index alerts view accessible | PASS
(1 row)

-- Test 18: Alert severity
SELECT 
    'Alert severity levels correct' AS test_name,
    CASE 
        WHEN count(*) >= 0 AND 
             count(*) FILTER (WHERE severity IN ('INFO', 'WARNING', 'CRITICAL')) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_alerts;
           test_name           | result 
-------------------------------+--------
 Alert severity levels correct | PASS
(1 row)

-- Test 19: pg_stat_insights_index_dashboard - Dashboard
SELECT 
    'Index dashboard view accessible' AS test_name,
    CASE 
        WHEN count(*) > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_dashboard;
            test_name            | result 
---------------------------------+--------
 Index dashboard view accessible | PASS
(1 row)

-- Test 20: Dashboard JSON structure
SELECT 
    'Dashboard JSON structure valid' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE section IN ('SUMMARY', 'BLOAT', 'UNUSED', 'ALERT') AND details IS NOT NULL) > 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_dashboard;
           test_name            | result 
--------------------------------+--------
 Dashboard JSON structure valid | PASS
(1 row)

-- Test 21: pg_stat_insights_missing_indexes - Missing index recommendations
SELECT 
    'Missing indexes view accessible' AS test_name,
    CASE 
        WHEN count(*) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_missing_indexes;
            test_name            | result 
---------------------------------+--------
 Missing indexes view accessible | PASS
(1 row)

-- Test 22: Cache hit ratio validation
SELECT 
    'Index cache hit ratio valid' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE idx_cache_hit_ratio IS NULL OR (idx_cache_hit_ratio >= 0 AND idx_cache_hit_ratio <= 1)) = count(*) THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
          test_name          | result 
-----------------------------+--------
 Index cache hit ratio valid | PASS
(1 row)

-- Test 23: All views have proper permissions
SELECT 
    'Index views have PUBLIC SELECT permission' AS test_name,
    CASE 
        WHEN count(*) >= 9 THEN 'PASS'
        ELSE 'FAIL: Expected at least 9 views with PUBLIC SELECT, found ' || count(*)
    END AS result
FROM information_schema.table_privileges 
WHERE table_name LIKE 'pg_stat_insights_index%' 
  AND privilege_type = 'SELECT' 
  AND grantee = 'PUBLIC';
                 test_name                 | result 
-------------------------------------------+--------
 Index views have PUBLIC SELECT permission | PASS
(1 row)

-- Test 24: Index-only scan metrics
SELECT 
    'Index-only scan ratio calculated' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE index_only_scan_ratio IS NULL OR (index_only_scan_ratio >= 0 AND index_only_scan_ratio <= 1)) = count(*) THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
            test_name             | result 
----------------------------------+--------
 Index-only scan ratio calculated | PASS
(1 row)

-- Test 25: Index-only scan efficiency rating
SELECT 
    'Index-only scan efficiency rating works' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE index_only_scan_efficiency IS NULL OR index_only_scan_efficiency IN ('EXCELLENT', 'GOOD', 'FAIR', 'POOR')) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
                test_name                | result 
-----------------------------------------+--------
 Index-only scan efficiency rating works | PASS
(1 row)

-- Test 26: Selectivity metrics
SELECT 
    'Selectivity ratio calculated' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE selectivity_ratio IS NULL OR selectivity_ratio >= 0) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
          test_name           | result 
------------------------------+--------
 Selectivity ratio calculated | PASS
(1 row)

-- Test 27: Distinct value ratio
SELECT 
    'Distinct value ratio calculated' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE distinct_value_ratio IS NULL OR (distinct_value_ratio >= 0 AND distinct_value_ratio <= 1)) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
            test_name            | result 
---------------------------------+--------
 Distinct value ratio calculated | PASS
(1 row)

-- Test 28: Extended correlation (all index types)
SELECT 
    'Column correlation available for all index types' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE column_correlation IS NOT NULL) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
                    test_name                     | result 
--------------------------------------------------+--------
 Column correlation available for all index types | PASS
(1 row)

-- Test 29: Statistics age
SELECT 
    'Statistics age calculated' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE stats_age_days IS NULL OR stats_age_days >= 0) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
         test_name         | result 
---------------------------+--------
 Statistics age calculated | PASS
(1 row)

-- Test 30: I/O wait statistics placeholders
SELECT 
    'I/O wait statistics columns exist' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE avg_io_wait_ms IS NULL AND total_io_wait_ms IS NULL) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_indexes
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
             test_name             | result 
-----------------------------------+--------
 I/O wait statistics columns exist | PASS
(1 row)

-- Test 31: Maintenance history view
SELECT 
    'Maintenance history view accessible' AS test_name,
    CASE 
        WHEN count(*) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_maintenance_history
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
              test_name              | result 
-------------------------------------+--------
 Maintenance history view accessible | PASS
(1 row)

-- Test 32: Maintenance status
SELECT 
    'Maintenance status classification works' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE maintenance_status IN ('CURRENT', 'NEEDS_VACUUM', 'NEEDS_ANALYZE', 'STALE_VACUUM', 'STALE_ANALYZE')) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_maintenance_history
WHERE tablename IN ('idx_test_users', 'idx_test_orders');
                test_name                | result 
-----------------------------------------+--------
 Maintenance status classification works | PASS
(1 row)

-- Test 33: Duplicate index detection view
SELECT 
    'Duplicate index detection view accessible' AS test_name,
    CASE 
        WHEN count(*) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_duplicates;
                 test_name                 | result 
-------------------------------------------+--------
 Duplicate index detection view accessible | PASS
(1 row)

-- Test 34: Duplicate type classification
SELECT 
    'Duplicate type classification works' AS test_name,
    CASE 
        WHEN count(*) >= 0 AND 
             count(*) FILTER (WHERE duplicate_type IN ('EXACT_DUPLICATE', 'REDUNDANT', 'SAME_COLUMN', 'POTENTIAL_OVERLAP')) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_index_duplicates;
              test_name              | result 
-------------------------------------+--------
 Duplicate type classification works | PASS
(1 row)

-- Test 35: Enhanced missing indexes - benefit score
SELECT 
    'Enhanced missing indexes has benefit score' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE benefit_score IS NOT NULL AND benefit_score >= 0) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_missing_indexes;
                 test_name                  | result 
--------------------------------------------+--------
 Enhanced missing indexes has benefit score | PASS
(1 row)

-- Test 36: Enhanced missing indexes - estimated size
SELECT 
    'Enhanced missing indexes has estimated size' AS test_name,
    CASE 
        WHEN count(*) FILTER (WHERE estimated_index_size_mb IS NULL OR estimated_index_size_mb >= 0) >= 0 THEN 'PASS'
        ELSE 'FAIL'
    END AS result
FROM pg_stat_insights_missing_indexes;
                  test_name                  | result 
---------------------------------------------+--------
 Enhanced missing indexes has estimated size | PASS
(1 row)

-- Cleanup
DROP TABLE IF EXISTS idx_test_orders CASCADE;
DROP TABLE IF EXISTS idx_test_users CASCADE;
